<mat-card class="form-card">
  <mat-card-title>Ajouter une utilisation</mat-card-title>
  <mat-card-content>
    <form [formGroup]="form" (ngSubmit)="onSubmit()">

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Machine (Comprimeuse)</mat-label>
        <input matInput formControlName="compresseuse" required />
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Quantit√© (Nombre de comprim√©s)</mat-label>
        <input matInput type="number" formControlName="nombreComprimes" required />
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Emplacement de retour</mat-label>
        <input matInput formControlName="emplacementRetour" required />
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Commentaire</mat-label>
        <textarea matInput formControlName="commentaire"></textarea>
      </mat-form-field>

      <div class="lot-section">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Ajouter un lot</mat-label>
          <input matInput [formControl]="lotInput" (keyup.enter)="addLot()" placeholder="Entrer un num√©ro de lot" />
        </mat-form-field>
        <button mat-flat-button color="primary" (click)="addLot()">Ajouter</button>

        <ul class="lot-list">
          <li *ngFor="let lot of lotNumbers.controls; let i = index">
            {{ lot.value }}
            <button type="button" mat-icon-button color="warn" (click)="removeLot(i)">
              <span aria-hidden="true">üóëÔ∏è</span>
            </button>
          </li>
        </ul>
      </div>


      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Poin√ßons</mat-label>
        <mat-select formControlName="poinconIds" multiple>
          <mat-option *ngFor="let p of poincons" [value]="p.id">{{ p.reference }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Utilisateurs</mat-label>
        <mat-select formControlName="userIds" multiple>
          <mat-option *ngFor="let u of users" [value]="u.id">{{ u.nom }} {{ u.prenom }}</mat-option>
        </mat-select>
      </mat-form-field>

      <div class="form-actions">
        <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">Enregistrer</button>
        <button mat-button type="button" (click)="form.reset()">Annuler</button>
      </div>
    </form>
  </mat-card-content>
</mat-card>

<style>
.full-width {
  width: 100%;
  margin-bottom: 1rem;
}
.form-actions {
  display: flex;
  justify-content: flex-end;
  gap: 1rem;
  margin-top: 1.5rem;
}
.chip-list {
  margin-bottom: 1rem;
}
</style>
